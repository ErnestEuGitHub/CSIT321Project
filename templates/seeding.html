<link rel="stylesheet" href="../static/css/seeding.css">

<div class="container">
    <div class="table-container">
        <h1>Seeding</h1>
        <table id="1">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
                <!-- Initial 10 empty rows -->
            </tbody>
        </table>
    </div>

    <div class="table-container">
        <h1>Group 1</h1>
        <table id="2">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
                <!-- Initial 10 empty rows for the second table -->
            </tbody>
        </table>
    </div>

    <div class="table-container">
        <h1>Group 2</h1>
        <table id="3">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
                <!-- Initial 10 empty rows for the second table -->
            </tbody>
        </table>
    </div>
</div>

<!-- Modal for name selection -->
<div id="nameSelectionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Select a Name</h2>
        <ul id="nameList">
            <!-- Names will be populated dynamically -->
        </ul>
    </div>
</div>

<script>
    let rowId = 1;
    let secondRowId = 1;
    let thirdRowId = 1;

    function addPerson(cell, tableId) {
        const namesFromDatabase = ["Alice", "Bob", "Charlie", "David", "Eva", "Frank", "Grace"];

        const modal = document.getElementById('nameSelectionModal');
        modal.style.display = 'block';

        const nameList = document.getElementById('nameList');
        nameList.innerHTML = '';

        namesFromDatabase.forEach(name => {

            const listItem = document.createElement('li');
            listItem.textContent = name;
            listItem.onclick = function () {
                selectName(cell, name, tableId);
            };
            nameList.appendChild(listItem);
        });
    }

    function selectName(cell, selectedName, tableId) {

        const nameContainer = document.createElement('div');
        nameContainer.className = 'name-cell';

        const editableContent = document.createElement('span');
        editableContent.className = 'editable';
        editableContent.textContent = selectedName;

        const deleteButton = createDeleteButton(cell.parentNode, tableId); // Pass the row and tableId

        nameContainer.appendChild(editableContent);
        nameContainer.appendChild(deleteButton);

        cell.innerHTML = '';
        cell.appendChild(nameContainer);
        cell.parentNode.classList.add('has-name');

        // Sync changes with the corresponding cell in the other table
        const rowIndex = cell.parentNode.rowIndex - 1;
        const otherTableId = tableId === '1' ? '2' : '1';
        const otherTableRows = document.getElementById(otherTableId).getElementsByTagName('tbody')[0].rows;
        const correspondingCell = otherTableRows[rowIndex].cells[1];
        correspondingCell.innerHTML = nameContainer.innerHTML;

        closeModal(); // Close the modal after selecting a name
    }

    function createDeleteButton(row, tableId) {
        const deleteButton = document.createElement('button');
        deleteButton.className = 'delete-button';
        deleteButton.innerHTML = '&#10060;'; // Cross icon HTML entity

        deleteButton.addEventListener('click', function (event) {
            event.stopPropagation(); // Stop event propagation for delete button
            const nameCell = row.cells[1];
            nameCell.innerHTML = ''; // Clear the name content
            row.classList.remove('has-name'); // Remove 'has-name' class

            // Sync deletion with the corresponding cell in the other table
            const rowIndex = row.rowIndex - 1; // Adjust for zero-based index
            const otherTableRows = document.getElementById(tableId === '1' ? '2' : '1').getElementsByTagName('tbody')[0].rows;
            const correspondingCell = otherTableRows[rowIndex].cells[1];
            correspondingCell.innerHTML = ''; // Clear the content in the corresponding cell
        });

        return deleteButton;
    }


    function createEmptyRow(tableId) {
        const container = document.getElementById(tableId).getElementsByTagName('tbody')[0];
        const newRow = container.insertRow();

        const cell1 = newRow.insertCell(0);
        cell1.textContent = tableId === '1' ? rowId : (tableId === '2' ? secondRowId : thirdRowId);

        const cell2 = newRow.insertCell(1);
        cell2.textContent = ''; // Initially empty

        const uniqueId = tableId === '1' ? `row_${rowId}` : (tableId === '2' ? `second_row_${secondRowId}` : `third_row_${thirdRowId}`);
        newRow.dataset.rowId = uniqueId; // Set the data-row-id attribute

        if (tableId === '1') {
            rowId++;
        } else if (tableId === '2') {
            secondRowId++;
            if (secondRowId > 4) return; // Stop creating rows after 4 for Table 2
        } else {
            thirdRowId++;
            if (thirdRowId > 4) return; // Stop creating rows after 4 for Table 3
        }

        newRow.onclick = function () {
            enableEditing(newRow, tableId);
        };
    }


    function enableEditing(row, tableId) {
        const cell = row.cells[1];
        addPerson(cell, tableId);
        event.stopPropagation(); // Add this line to prevent the click from propagating further
    }

    function syncDelete(row) {
        const rowIdToDelete = row.dataset.rowId;
        const allRows = document.querySelectorAll('[data-row-id="' + rowIdToDelete + '"]');

        allRows.forEach(rowToDelete => {
            const nameCell = rowToDelete.cells[1];
            nameCell.innerHTML = '';
            rowToDelete.classList.remove('has-name');
        });

        closeModal();
    }

    function deleteEntry(row) {
        const deleteButton = row.querySelector('.delete-button');
        deleteButton.addEventListener('click', function (event) {
            event.stopPropagation(); // Stop event propagation for delete button
            syncDelete(row);
        });
    }

    // Delegate the event handling to the table rows
    document.querySelectorAll('table tbody tr').forEach(row => {
        deleteEntry(row);
    });


    for (let i = 0; i < 10; i++) {
        createEmptyRow('1');
    }
    for (let i = 0; i < 4; i++) {
        createEmptyRow('2');
        createEmptyRow('3');
    }

    // Function to close the modal
    function closeModal() {
        const modal = document.getElementById('nameSelectionModal');
        modal.style.display = 'none';
    }

    // Event listener for clicks on the document
    document.addEventListener('click', function (event) {
        const modal = document.getElementById('nameSelectionModal');
        const modalContent = document.querySelector('.modal-content');
        if (event.target !== modal && !modalContent.contains(event.target)) {
            closeModal(); // Close the modal if the click is outside the modal or its content
        }
    });

</script>